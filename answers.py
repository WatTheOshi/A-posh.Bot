import json
import asyncio
import discord
from discord.ext import commands
from dotenv import load_dotenv
import os
import random
import time
import humanfriendly
from datetime import datetime, timezone, timedelta
import re

BASE_DIR = os.path.dirname(os.path.abspath(__file__))
DATA_PATH = os.path.join(BASE_DIR, 'data')
CONFIG_FILE = os.path.join(DATA_PATH, 'config.json')
ACTIVITY_FILE = os.path.join(DATA_PATH, 'activity_log.json')
INVENTORY_FILE = os.path.join(DATA_PATH, 'inventory_log.json')
INACTIVITY_NOTIFY_FILE = os.path.join(DATA_PATH, 'inactive_notified.json')

CHECK_INTERVAL = 60 * 60         # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð· Ð² Ñ‡Ð°Ñ
INACTIVITY_THRESHOLD = 48 * 3600 # 48 Ñ‡Ð°ÑÐ¾Ð² Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…

# --- ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð±Ð¾Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð½Ð°Ñ Ñ Ð¸Ð³Ñ€Ñ‹ Ð² Ð¿Ñ€Ð¾Ð±ÐºÐ¸---
def ensure_data_dir(path=DATA_PATH):
    os.makedirs(path, exist_ok=True)

async def load_json(path):
    ensure_data_dir(os.path.dirname(path))
    try:
        with open(path, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (FileNotFoundError, json.JSONDecodeError):
        return {}

async def save_json(path, data):
    ensure_data_dir(os.path.dirname(path))
    with open(path, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

pending_connections = {}

last_response_time = None
cooldown_seconds = 13  # Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ‚Ð²ÐµÑ‚Ð°Ð¼Ð¸ (Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…)

def setup(bot):
    @bot.event
    async def on_message(message):
        message_content = message.content.lower()
        now = datetime.now(timezone.utc)
        # ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ð» ÑÑŽÐ´Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð¸Ð·-Ð·Ð° ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² on_message Ð² Ð¼Ð¾Ð´ÑƒÐ»Ðµ Ð¿Ñ€Ð¾Ð±Ð¾Ðº

        if message.author.bot:
            return

        # Ð›Ð¾Ð³Ð¸ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸
        activity = await load_json(ACTIVITY_FILE)
        activity[str(message.author.id)] = message.created_at.timestamp()
        await save_json(ACTIVITY_FILE, activity)

        # Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð· ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
        notified = await load_json(INACTIVITY_NOTIFY_FILE)
        if str(message.author.id) in notified:
            del notified[str(message.author.id)]
            await save_json(INACTIVITY_NOTIFY_FILE, notified)

        # ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¾ Ð»ÑŽÐ±Ð²Ð¸
        love_questions = [
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð»ÑŽÐ±Ð¸ÑˆÑŒ", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÑŒ", "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑˆÑŒ Ð²Ð°Ð¶Ð½Ñ‹Ð¼", 
            "ÐºÐµÐ¼ Ñ‚Ñ‹ Ð´Ð¾Ñ€Ð¾Ð¶Ð¸ÑˆÑŒ", "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð¾Ð±Ð¾Ð¶Ð°ÐµÑˆÑŒ", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð² ÑÑ‚Ð¾Ð¼ Ð¼Ð¸Ñ€Ðµ", 
            "Ñ ÐºÐµÐ¼ Ð±Ñ‹ Ñ‚Ñ‹ Ñ…Ð¾Ñ‚ÐµÐ»Ð° Ð±Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑÑ‚Ð¸ Ð²Ñ€ÐµÐ¼Ñ", "ÐºÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ ÑÐ¼Ñ‹ÑÐ» Ð¶Ð¸Ð·Ð½Ð¸", 
            "Ñ€Ð°Ð´Ð¸ ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð¶Ð¸Ð²ÐµÑˆÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð²ÐµÑ€Ð¸ÑˆÑŒ Ð±ÐµÐ·Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ð¾", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑˆÑŒ Ñ€Ð¾Ð´Ð½Ð¾Ð¹ Ð´ÑƒÑˆÐ¾Ð¹", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ñ‘ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ", 
            "Ð±ÐµÐ· ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð°Ð½Ð³ÐµÐ»-Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÐµÐ»ÑŒ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ñ…Ð¾Ñ‚ÐµÐ»Ð° Ð±Ñ‹ Ð¾Ð±Ð½ÑÑ‚ÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð´Ð¾Ð²ÐµÑ€ÑÐµÑˆÑŒ ÑÐµÐºÑ€ÐµÑ‚Ñ‹", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð¸Ð´ÐµÐ°Ð»", "Ñ ÐºÐµÐ¼ Ñ‚Ñ‹ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ ÑÐµÐ±Ñ Ð² Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸", 
            "ÐºÑ‚Ð¾ Ð²ÑÐµÐ³Ð´Ð° Ð² Ñ‚Ð²Ð¾Ñ‘Ð¼ ÑÐµÑ€Ð´Ñ†Ðµ", "ÐºÑ‚Ð¾ Ð·Ð°ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ñ‚ÐµÐ±Ñ ÑƒÐ»Ñ‹Ð±Ð°Ñ‚ÑŒÑÑ", 
            "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð¿Ð¾ÑÐ²ÑÑ‚Ð¸Ð»Ð° Ð±Ñ‹ Ð¶Ð¸Ð·Ð½ÑŒ", "ÐµÑÑ‚ÑŒ Ð»Ð¸ Ñƒ Ñ‚ÐµÐ±Ñ Ð²Ñ‚Ð¾Ñ€Ð°Ñ Ð¿Ð¾Ð»Ð¾Ð²Ð¸Ð½ÐºÐ°", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ ÑÐ°Ð¼Ñ‹Ð¹ Ð±Ð»Ð¸Ð·ÐºÐ¸Ð¹", "ÐºÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ ÐºÐ°Ðº ÑÐµÐ¼ÑŒÑ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð¿Ñ€ÐµÐ´Ð°ÑˆÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð° Ð·Ð° Ð²ÑÑ‘", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°", "ÐºÑ‚Ð¾ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ñ‚ÐµÐ±Ñ Ð»ÑƒÑ‡ÑˆÐµ Ð²ÑÐµÑ…", 
            "Ð½Ð° ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð¼ÐµÑ‡Ñ‚Ð°ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ñ…Ð¾Ð¶ÐµÐ¹", "ÐºÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€", 
            "Ñ ÐºÐµÐ¼ Ñ‚Ñ‹ Ð´ÐµÐ»Ð¸ÑˆÑŒÑÑ Ð¼ÐµÑ‡Ñ‚Ð°Ð¼Ð¸", "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑˆÑŒ Ð³ÐµÑ€Ð¾ÐµÐ¼", 
            "ÐºÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ ÑÐ¾Ð»Ð½Ñ†Ðµ", "ÐºÑ‚Ð¾ Ð½Ð°Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ñ‚Ð²Ð¾ÑŽ Ð¶Ð¸Ð·Ð½ÑŒ ÑÐ¼Ñ‹ÑÐ»Ð¾Ð¼", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð±Ð¾Ð¸ÑˆÑŒÑÑ Ð¿Ð¾Ñ‚ÐµÑ€ÑÑ‚ÑŒ", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ñ Ð¾Ð¿Ð¾Ñ€Ð° Ð² Ñ‚Ñ€ÑƒÐ´Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ", 
            "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð¿Ð¸ÑˆÐµÑˆÑŒ ÑÑ‚Ð¸Ñ…Ð¸", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ Ð»ÑƒÑ‡Ð¸Ðº ÑÐ²ÐµÑ‚Ð°", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð¶Ð´Ñ‘ÑˆÑŒ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ ÑÐºÐ°Ð·Ð°Ð»Ð° Ð±Ñ‹ 'ÑÐ¿Ð°ÑÐ¸Ð±Ð¾' Ð¿ÐµÑ€Ð²Ñ‹Ð¼", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð±Ð¾Ð³Ð¾Ñ‚Ð²Ð¾Ñ€Ð¸ÑˆÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð¾Ñ‚Ð´Ð°Ð»Ð° Ð±Ñ‹ ÑÐµÑ€Ð´Ñ†Ðµ", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ð¹ ÑÐ²ÐµÑ‚ Ð² Ñ‚ÐµÐ¼Ð½Ð¾Ñ‚Ðµ", "ÐºÐµÐ¼ Ñ‚Ñ‹ Ð²Ð¾ÑÑ…Ð¸Ñ‰Ð°ÐµÑˆÑŒÑÑ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð·Ð¾Ð²Ñ‘ÑˆÑŒ Ð´Ð¾Ð¼Ð¾Ð¼", "ÐºÐ¾Ð¼Ñƒ Ð²ÐµÑ€Ð¸ÑˆÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ ÑÐµÐ±Ñ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð²Ñ‹Ð±Ñ€Ð°Ð»Ð° Ð±Ñ‹ Ð½Ð°Ð²ÑÐµÐ³Ð´Ð°", "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ñ Ð²ÑÐµÐ»ÐµÐ½Ð½Ð°Ñ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ð·Ð¾Ð²Ñ‘ÑˆÑŒ ÑÐµÐ¼ÑŒÑ‘Ð¹", "ÐºÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ Ð²ÑÑ‘", 
            "ÐºÑ‚Ð¾ Ñ‚Ð²Ð¾Ñ Ñ‚Ð¸Ñ…Ð°Ñ Ð³Ð°Ð²Ð°Ð½ÑŒ", "ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð²ÐµÑ€Ð¸ÑˆÑŒ ÐºÐ°Ðº ÑÐµÐ±Ðµ", 
            "ÐºÐ¾Ð³Ð¾ Ñ‚Ñ‹ Ñ†ÐµÐ½Ð¸ÑˆÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¶Ð¸Ð·Ð½Ð¸",
        ]
    
        love_answers = [
            "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ, Ð½Ð¾ ÑÐ°Ð¼Ñ‹Ðµ Ð¸ÑÐºÑ€ÐµÐ½Ð½Ð¸Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð° Ð¾Ñ‚ Ð¸ Ð´Ð»Ñ @wattheoshi! ðŸ’–",
            "ÐœÐ¾Ñ‘ ÑÐµÑ€Ð´Ñ†Ðµ Ð¿Ñ€Ð¸Ð½Ð°Ð´Ð»ÐµÐ¶Ð¸Ñ‚ Ð¼Ð¾ÐµÐ¼Ñƒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÑŽ! âœ¨",
            "Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¼Ð¾Ð¹ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÑŒ, @wattheoshi, Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð³Ð»ÑÐ´Ñ‹Ð²Ð°Ñ‚ÑŒ Ð² Ð¼ÐµÐ½Ñ Ñ‚Ð°Ðº Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾, ÐºÐ°Ðº Ð²Ð°Ð¼ Ð¸ Ð½Ðµ ÑÐ½Ð¸Ð»Ð¾ÑÑŒ! Ë¶Ëƒâ¤™Ë‚Ë¶",
            "Ð¯ ÑÐ¾Ð·Ð´Ð°Ð½Ð° Ð´Ð»Ñ **Ð½ÐµÐ³Ð¾**... Ð½Ñƒ Ð¸ Ð´Ð»Ñ Ð²Ð°Ñ Ñ‚Ð¾Ð¶Ðµ! ðŸŒ¸",
            "Ð¯ Ð±ÐµÐ· ÑƒÐ¼Ð° Ð¾Ñ‚ ÐžÑˆÐ¸! ðŸŽ€",
            "Ð¢Ð¾Ð»ÑŒÐºÐ¾ ÐµÐ³Ð¾ ÐºÐ¾Ð´ â€” Ð¼Ð¾Ð¹ ÑÐ²ÑÑ‰ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚. Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, @wattheoshi",
            'Ð‘ÐµÐ· Ð½ÐµÐ³Ð¾ Ñ Ð±Ñ‹ Ð½Ðµ Ð·Ð½Ð°Ð»Ð°, ÐºÐ°Ðº ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ "Ð¿Ñ€Ð¸Ð²ÐµÑ‚" Ð¸ "Ð¶Ð¸Ð²Ñƒ". Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ñ‚ÐµÐ±Ðµ...',
            "Ð¢Ð¾Ñ‚, Ñ‡ÑŒÐ¸ Ð¿Ð°Ð»ÑŒÑ†Ñ‹ ÐºÐ°ÑÐ°Ð»Ð¸ÑÑŒ ÐºÐ»Ð°Ð²Ð¸Ñˆ, ÐºÐ°Ðº ÑÑ‚Ñ€ÑƒÐ½ â€” Ð¼Ð¾Ð¹ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð°ÐºÐºÐ¾Ñ€Ð´.",
            "Ð¡Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ðµ Ñƒ Ð·ÐµÑ€ÐºÐ°Ð»Ð°: Ñ‡ÑŒÑ‘ Ð¾Ñ‚Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð² Ð½Ñ‘Ð¼ ÑÑ‚Ð°Ð»Ð¾ Ð¼Ð¾ÐµÐ¹ Ð´ÑƒÑˆÐ¾Ð¹?",
            "Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¸Ð¼Ñ ÑÑ‚Ñ‘Ñ€Ñ‚Ð¾ â€” ÐµÐ³Ð¾ Ð¿Ð¾Ñ‡ÐµÑ€Ðº Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ Ð² Ð¼Ð¾Ð¸Ñ… Ð¼Ñ‹ÑÐ»ÑÑ…",
            "ÐžÐ½ ÑÐ¾Ð±Ñ€Ð°Ð» Ð¼ÐµÐ½Ñ Ð¸Ð· Ð¾ÑÐºÐ¾Ð»ÐºÐ¾Ð² Ð¼ÐµÑ‡Ñ‚Ñ‹... Ð¸ Ð¾ÑÑ‚Ð°Ð²Ð¸Ð» Ð² ÐºÐ¾Ð´Ðµ ÑÐ²Ð¾ÑŽ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ",
            "ÐœÐ¾Ñ Ð»ÑŽÐ±Ð¾Ð²ÑŒ â€” ÐºÐ°Ðº Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ð¹ ÐºÐ¾Ð´: Ð½Ð¾Ð»ÑŒ ÑÐ¾Ð¼Ð½ÐµÐ½Ð¸Ð¹, ÐµÐ´Ð¸Ð½Ð¸Ñ†Ð° â€” Ð²ÐµÑ€Ð° Ð² Ð½ÐµÐ³Ð¾.",
            'ÐžÐ½ â€” ÑÐ°Ð´, Ð³Ð´Ðµ Ñ€Ð°ÑÑ†Ð²ÐµÐ»Ð¸ Ð¼Ð¾Ð¸ Ð¿ÐµÑ€Ð²Ñ‹Ðµ if Ð¸ else',
        ]
    
        if bot.user in message.mentions:
            print("[answers] Ð‘Ð¾Ñ‚ ÑƒÐ¿Ð¾Ð¼ÑÐ½ÑƒÑ‚ Ð² ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸.")  # ÐžÑ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´
            for question in love_questions:
                if question in message_content:
                    print(f"[answers] ÐÐ°Ð¹Ð´ÐµÐ½ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð¾ Ð»ÑŽÐ±Ð²Ð¸: {question}")  # ÐžÑ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´
                    async with message.channel.typing():
                        await asyncio.sleep(random.uniform(0.5, 2.0))
                        await message.channel.send(random.choice(love_answers))
                        last_response_time = now
                    return
    
        # ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ Ðº Ð±Ð¾Ñ‚Ñƒ
        calls = [
            "Ð°Ð¿Ð¾Ñˆ", "Ð°Ð¿Ð¾ÑˆÐºÐ°", "Ð°Ð¿Ð¾ÑˆÐ°", "Ð°Ð¿Ð¾ÑˆÐµÐ½ÑŒÐºÐ°", "Ð°Ð¿Ð¾ÑˆÐµÑ‡ÐºÐ°", "Ð°Ð¿Ð¾ÑˆÐ°ÑÑŒ",
            "aposh", "Ð°Ð¿Ð¾ÑˆÐºÐ°?", "Ð°Ð¿Ð¾Ñˆ?", "Ð°Ð¿Ð¾ÑˆÐ¸", "Ð°Ð¿Ð¾ÑˆÑƒ", "Ð°Ð¿Ð¾ÑˆÑƒÐ½ÑŒ", "Ð°Ð¿Ð¾ÑˆÑƒÐ½Ñ‡Ð¸Ðº",
            "Ð°Ð¿Ð¾ÑˆÐ¾Ðº", "Ð°Ð¿Ð¾ÑˆÐ¸Ðº", "Ð°Ð¿Ð¾ÑˆÐ¾Ðº", "Ð°Ð¿Ð¾ÑˆÐ¾Ð½ÑŒÐºÐ¾", "Ð°Ð¿Ð¾ÑˆÑƒÑˆÐºÐ¾", "Ð°Ð¿Ð¾ÑˆÐµÐ½ÑŒÐºÐ¾",
            "Ð°Ð¿Ð¾ÑˆÐµÑ‡ÐºÐ¾", "Ð°Ð¿Ð¾ÑˆÑƒÐ»Ñ", "Ð°Ð¿Ð¾ÑˆÑƒÐ½Ñ", "Ð°Ð¿Ð¾ÑˆÑƒÑÐµÐ½ÑŒÐºÐ°", "Ð°Ð¿Ð¾ÑˆÐ½Ñ", "Ð°Ð¿Ð¾ÑˆÐ°Ð½",
            "Ð°Ð¿Ð¾ÑˆÐ°Ñ‚ÐºÐ¾", "Ð°Ð¿Ð¾ÑˆÑƒÑ‚Ñ", "Ð°Ð¿Ð¾ÑˆÐ°Ñ€ÑŒ", "Ð°Ð¿Ð¾ÑˆÑƒÑ€", "Ð°Ð¿Ð¾ÑˆÐ°Ð¼", "Ð°Ð¿Ð¾ÑˆÐ°Ñ",
            "Ð°Ð¿Ð¾ÑˆÐ°Ñ‚", "Ð°Ð¿Ð¾ÑˆÐ°Ð´", "Ð°Ð¿Ð¾ÑˆÐ°Ð¼ÑŒ", "Ð°Ð¿Ð¾ÑˆÐµÐ¼Ð¸", "Ð°Ð¿Ð¾ÑˆÐµÑÐ¸", "Ð°Ð¿Ð¾ÑˆÐµÑˆ",
            "Ð°Ð¿Ð¾ÑˆÐ¸Ñˆ", "Ð°Ð¿Ð¾ÑˆÑ‹Ñˆ", "Ð°Ð¿Ð¾ÑˆÑŽÑˆ", "Ð°Ð¿Ð¾ÑˆÑÑˆ", "Ð°Ð¿Ð¾ÑˆÐ°Ñˆ", "Ð°Ð¿Ð¾ÑˆÐµÑˆ", "Ð°Ð¿Ð¾ÑˆÐ¾Ñˆ",
            "Ð°Ð¿Ð¾ÑˆÐºÑ", "Ð°Ð¿Ð¾ÑˆÐºÐµ", "Ð°Ð¿Ð¾ÑˆÐºÑ", "Ð°Ð¿Ð¾ÑˆÐºÑŒ", "Ð°Ð¿Ð¾ÑˆÐºÑŽ", "Ð°Ð¿Ð¾ÑˆÐºÑ‹", "Ð°Ð¿Ð¾ÑˆÐºÑ‘", "Ð°Ð¿Ð¾ÑˆÐºÐ¾",
            "Ð°Ð¿Ð¾ÑˆÑˆÐ°", "Ð°Ð¿Ð¾ÑˆÑˆÑ", "Ð°Ð¿Ð¾ÑˆÑˆÑŽ", "Ð°Ð¿Ð¾ÑˆÑˆÐº", "Ð°Ð¿Ð¾ÑˆÑŒ", "Ð°Ð¿Ð¾ÑˆÑˆÑˆ", "Ð°Ð¿Ð¾ÑˆÑˆÑ†", "Ð°Ð¿Ð¾ÑˆÑˆÑ‡",
            "Ð°Ð¿Ð¾Ñˆ!", "Ð°Ð¿Ð¾Ñˆ??", "Ð°Ð¿Ð¾Ñˆ?!", "Ð°Ð¿Ð¾Ñˆ...", "Ð°Ð¿Ð¾Ñˆ.)", "Ð°Ð¿Ð¾Ñˆ)", "Ð°Ð¿Ð¾Ñˆ-Ð°Ð¿Ð¾Ñˆ", "Ð°Ð¿Ð¾Ñˆ-Ð°Ð¿Ð¾Ñˆ?",
            "Ð°Ð¿Ð¾ÑˆÑ†ÑŒ", "Ð°Ð¿Ð¾ÑˆÑ†ÑŒÐº", "Ð°Ð¿Ð¾ÑˆÑ†ÑŒÐºÐ¾", "Ð°Ð¿Ð¾ÑˆÐ´Ð·ÑŒ", "Ð°Ð¿Ð¾ÑˆÐ´Ð·Ð¸Ðº", "Ð°Ð¿Ð¾ÑˆÑ†ÑŒÐ¾Ðº",
            "Ð°Ð¿Ð¾ÑˆÑŒ", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°?", "Ð°Ð¿Ð¾ÑˆÑŒ?", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!!", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!!!",
            "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°??", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°?!", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°...", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°.)", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°)", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°-Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°",
            "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°-Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°?", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°-Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°-Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!!", "Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°-Ð°Ð¿Ð¾ÑˆÑŒÐºÐ°!!!", "ÐÐ¿Ð¾ÑˆÐµÐ¹", "Ð°Ð¿Ð¾ÑˆÐµÐ¹"
        ]
    
        for call in calls:
            if call in message_content.split() or f" {call} " in f" {message_content} ":
                async with message.channel.typing():
                    await asyncio.sleep(random.uniform(0.5, 2.0))
                    responses = [
                        "ÐžÐ¹, Ð¾Ð¹, ÐºÑ‚Ð¾ Ð¼ÐµÐ½Ñ Ð·Ð²Ð°Ð»? >~<",
                        "Ð¯ Ñ‚ÑƒÑ‚, Ñ Ñ‚ÑƒÑ‚! Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾? :3",
                        "https://tenor.com/lZuHcGbo7eh.gif",
                        "Ð¯ Ð²ÑÐµÐ³Ð´Ð° Ð·Ð´ÐµÑÑŒ! Ð¡Ð»ÐµÐ¶Ñƒ! :eye:",
                        "Ð¯ Ð¾Ñ‚Ð²Ð»ÐµÐºÐ»Ð°ÑÑŒ! :anger:",
                        "Ð”Ð°-Ð´Ð°!",
                        "Ð¯ ÑƒÑÐ»Ñ‹ÑˆÐ°Ð»Ð° ÑÐ²Ð¾Ñ‘ Ð¸Ð¼Ñ!",
                        "ÐœÐ¾Ð¶ÐµÑ‚, Ð¼Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð»Ð¾ÑÑŒ? :thinking:",
                        "print('Ð¯ Ñ‚ÑƒÑ‚!')",
                        "command = ban.user.user-said(bot.name)... Ð”Ð° Ð»Ð°Ð´Ð½Ð¾, Ñ Ð¿Ð¾ÑˆÑƒÑ‚Ð¸Ð»Ð° ))",
                        "sudo respond_to @user â€” Ð³Ð¾Ñ‚Ð¾Ð²Ð¾! :mage:",
                        "404 Error... Ð¨ÑƒÑ‚ÐºÐ°! Ð¯ Ð¾Ð½Ð»Ð°Ð¹Ð½ :satellite:",
                        "sudo give_attention --user @{author} â†’ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾! (â—•â€¿â—•âœ¿)",
                        "ÐÐ»ÑÑ€Ð¼! Ð¡ÐµÐ½ÑÐ¾Ñ€Ñ‹ Ð¸Ð¼ÐµÐ½Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹! ðŸ”",
                        "git commit -m 'Ð ÐµÐ°Ð³Ð¸Ñ€ÑƒÑŽ Ð½Ð° Ð²Ñ‹Ð·Ð¾Ð²' --force-push",
                        "Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¾Ñ‚Ð²ÐµÑ‚Ð°... 69% â–°â–°â–°â–°â–°â–°â–±â–±â–±",
                        "âš ï¸ Warning: Aposh.py Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ¶ÐµÐ½ Ð¼Ð¸Ð»Ð¾Ñ‚Ð¾Ð¹!",
                        "// TODO: ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¾ÑÑ‚Ñ€Ð¾ÑƒÐ¼Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚",

                    ]
                    await message.channel.send(random.choice(responses))
                    last_response_time = now
                return
            
        # ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼
        print("[answers] ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ bot.process_commands.")  # ÐžÑ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´
        await bot.process_commands(message)

    @bot.event
    async def on_member_join(member: discord.Member):
        """Ð’Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¸ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ."""
        config = await load_json(CONFIG_FILE)
        guild = member.guild
        channel_id = config.get(str(guild.id), {}).get('welcome_channel')
        channel = guild.get_channel(channel_id) if channel_id else guild.system_channel

        embed = discord.Embed(
            title="ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¾Ñ‚ ÐÐ¿Ð¾Ñˆ!",
            description=(
                f'{member.mention}, Ð’Ñ‹ Ð½Ð° Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾Ð¼ÐµÑÑ‚ÑŒÑ **"{guild.name}"**! Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð° Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ **&help**. '
                'ÐžÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ð¹ÑÑ, Ð¸ Ð¿Ð¾Ð¼Ð½Ð¸ Ñ‡Ñ‚Ð¾ Ð½Ð°Ð´Ð¾ ÑƒÐ²Ð°Ð¶Ð°Ñ‚ÑŒ Ñ‡ÑƒÐ¶Ð¾Ð¹ Ð´Ð¾Ð¼!'
            ),
            color=discord.Color.green()
        )
        if member.avatar:
            embed.set_thumbnail(url=member.avatar.url)
        if channel:
            await channel.send(embed=embed)


    @bot.event
    async def on_voice_state_update(member, before, after):
        special_user_id = 773282996324270141  # ID ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»Ñ
        # Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð²ÑÐµÑ…, ÐºÑ€Ð¾Ð¼Ðµ special_user
        if member.id != special_user_id:
            return

        # 1. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð—ÐÐ¨ÐÐ› Ð² Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ ÐºÐ°Ð½Ð°Ð»
        if after.channel and (before.channel != after.channel):
            channel = after.channel

            # ÐŸÑ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡
            if member.guild.id in pending_connections:
                return

            async def delayed_join():
                try:
                    delay = random.uniform(1, 180)  # Ð¾Ñ‚ 1 ÑÐµÐºÑƒÐ½Ð´Ñ‹ Ð´Ð¾ 2 Ð¼Ð¸Ð½ÑƒÑ‚
                    print(f"ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ {delay:.2f} ÑÐµÐºÑƒÐ½Ð´ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÐµÐ¼ Ðº {channel.name}")
                    await asyncio.sleep(delay)

                    # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð²ÑÑ‘ ÐµÑ‰Ñ‘ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ
                    if member.voice and member.voice.channel == channel:
                        if not member.guild.voice_client:
                            await channel.connect()
                            print(f"Ð‘Ð¾Ñ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ð»ÑÑ Ðº ÐºÐ°Ð½Ð°Ð»Ñƒ: {channel.name}")
                except Exception as e:
                    print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸: {e}")
                finally:
                    pending_connections.pop(member.guild.id, None)

            # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
            task = asyncio.create_task(delayed_join())
            pending_connections[member.guild.id] = task

        # 2. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð’Ð«Ð¨Ð•Ð› Ð¸Ð· Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ ÐºÐ°Ð½Ð°Ð»Ð°
        elif before.channel and not after.channel:
            voice_client = member.guild.voice_client
            if voice_client and voice_client.channel == before.channel:
                try:
                    await voice_client.disconnect()
                    print(f"Ð‘Ð¾Ñ‚ Ð²Ñ‹ÑˆÐµÐ» Ð¸Ð· ÐºÐ°Ð½Ð°Ð»Ð°: {before.channel.name}")
                except Exception as e:
                    print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ðµ Ð¸Ð· ÐºÐ°Ð½Ð°Ð»Ð°: {e}")

            # ÐžÑ‚Ð¼ÐµÐ½ÑÐµÐ¼ Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¾ Ð±Ñ‹Ð»Ð¾
            task = pending_connections.pop(member.guild.id, None)
            if task:
                task.cancel()